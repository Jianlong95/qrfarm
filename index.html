<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stardew Lite</title>
    <style>
        body {
            margin: 0;
            background-color: #222;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Courier New', monospace;
            color: white;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            cursor: crosshair;
        }

        canvas {
            background-color: #4CAF50; /* Grass Color */
            display: block;
            border-radius: 4px;
        }

        #ui-bar {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #8d6e63;
        }

        .tool {
            width: 50px;
            height: 50px;
            background: #d7ccc8;
            border: 4px solid #5d4037;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            position: relative;
        }

        .tool.active {
            border-color: #f1c40f;
            background: #fff;
            transform: translateY(-5px);
        }

        .tool span.key {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
            color: #555;
        }

        #money-box {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 20px;
            border: 2px solid #f1c40f;
            color: #f1c40f;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div id="money-box">ðŸ’° <span id="money-display">0</span></div>

        <div id="ui-bar">
            <div class="tool active" id="tool-1" onclick="setTool(1)">
                <span class="key">1</span>ðŸ”¨
            </div>
            <div class="tool" id="tool-2" onclick="setTool(2)">
                <span class="key">2</span>ðŸ’§
            </div>
            <div class="tool" id="tool-3" onclick="setTool(3)">
                <span class="key">3</span>ðŸŒ±
            </div>
            <div class="tool" id="tool-4" onclick="setTool(4)">
                <span class="key">4</span>ðŸ§º
            </div>
        </div>
    </div>

    <script>
        // --- GAME ENGINE SETUP ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Settings
        const TILE_SIZE = 40;
        const COLS = 20;
        const ROWS = 15;

        // Colors & Assets (Drawn via code)
        const COLORS = {
            grass: '#4CAF50',
            dirt: '#795548',
            wetDirt: '#4E342E',
            hover: 'rgba(255, 255, 255, 0.3)',
            player: '#FF5722',
            hat: '#FBC02D'
        };

        // --- GAME STATE ---
        let money = 0;
        let currentTool = 1; // 1: Hoe, 2: Water, 3: Seeds, 4: Harvest

        // The Map (0 = Grass, 1 = Dirt, 2 = Wet Dirt)
        let map = [];
        // The Crops (Object with key "x,y")
        let crops = {};

        // The Player
        let player = { x: 400, y: 300, speed: 4, size: 20 };

        // Input Tracking
        let keys = {};
        let mouse = { x: 0, y: 0 };

        // --- INITIALIZATION ---
        function init() {
            // Build empty map
            for (let r = 0; r < ROWS; r++) {
                let row = [];
                for (let c = 0; c < COLS; c++) {
                    row.push(0);
                }
                map.push(row);
            }

            // Start Loops
            requestAnimationFrame(gameLoop);
            setInterval(growPlants, 2000); // Plants grow every 2 seconds
        }

        // --- CORE LOOPS ---

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // Player Movement (Smooth)
            if (keys['w'] || keys['ArrowUp']) player.y = Math.max(0, player.y - player.speed);
            if (keys['s'] || keys['ArrowDown']) player.y = Math.min(canvas.height - player.size, player.y + player.speed);
            if (keys['a'] || keys['ArrowLeft']) player.x = Math.max(0, player.x - player.speed);
            if (keys['d'] || keys['ArrowRight']) player.x = Math.min(canvas.width - player.size, player.x + player.speed);
        }

        function growPlants() {
            for (let key in crops) {
                let crop = crops[key];
                let [c, r] = key.split(',').map(Number);

                // Only grow if soil is wet (map value 2)
                if (map[r][c] === 2) {
                    if (crop.stage < 3) {
                        crop.stage++;
                    } else {
                        // Reset soil to dry after full growth (optional mechanic)
                        map[r][c] = 1;
                    }
                }
            }
        }

        // --- RENDERING ---

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. Draw Map Tiles
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    let tileType = map[r][c];
                    let x = c * TILE_SIZE;
                    let y = r * TILE_SIZE;

                    if (tileType === 0) ctx.fillStyle = COLORS.grass;
                    else if (tileType === 1) ctx.fillStyle = COLORS.dirt;
                    else if (tileType === 2) ctx.fillStyle = COLORS.wetDirt;

                    ctx.fillRect(x, y, TILE_SIZE, TILE_SIZE);
                    // Draw grid lines slightly
                    ctx.strokeStyle = 'rgba(0,0,0,0.05)';
                    ctx.strokeRect(x, y, TILE_SIZE, TILE_SIZE);
                }
            }

            // 2. Draw Crops
            for (let key in crops) {
                let crop = crops[key];
                let [c, r] = key.split(',').map(Number);
                let cx = c * TILE_SIZE + TILE_SIZE/2;
                let cy = r * TILE_SIZE + TILE_SIZE/2;

                if (crop.stage === 1) {
                    // Seed
                    ctx.fillStyle = '#CDDC39';
                    ctx.beginPath(); ctx.arc(cx, cy, 4, 0, Math.PI*2); ctx.fill();
                } else if (crop.stage === 2) {
                    // Sprout
                    ctx.fillStyle = '#8BC34A';
                    ctx.fillRect(cx - 5, cy - 8, 10, 16);
                } else if (crop.stage === 3) {
                    // Mature (Parsnip/Carrot look)
                    ctx.fillStyle = '#FF9800'; // Body
                    ctx.beginPath(); ctx.arc(cx, cy+5, 8, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = '#4CAF50'; // Leaves
                    ctx.fillRect(cx - 8, cy - 15, 16, 10);
                }
            }

            // 3. Draw Selection Box (The Cursor)
            let selCol = Math.floor(mouse.x / TILE_SIZE);
            let selRow = Math.floor(mouse.y / TILE_SIZE);

            // Distance check (Can only farm near player)
            let playerCol = Math.floor((player.x + player.size/2) / TILE_SIZE);
            let playerRow = Math.floor((player.y + player.size/2) / TILE_SIZE);
            let dist = Math.abs(selCol - playerCol) + Math.abs(selRow - playerRow);

            if (dist < 3) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.fillRect(selCol * TILE_SIZE, selRow * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.strokeRect(selCol * TILE_SIZE, selRow * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            }

            // 4. Draw Player
            // Body
            ctx.fillStyle = COLORS.player;
            ctx.fillRect(player.x, player.y, player.size, player.size);
            // Hat (Stardew Style)
            ctx.fillStyle = COLORS.hat;
            ctx.fillRect(player.x - 2, player.y - 5, player.size + 4, 8);
            // Eyes
            ctx.fillStyle = 'black';
            ctx.fillRect(player.x + 5, player.y + 5, 4, 4);
            ctx.fillRect(player.x + 13, player.y + 5, 4, 4);
        }

        // --- INTERACTION ---

        function handleAction() {
            let c = Math.floor(mouse.x / TILE_SIZE);
            let r = Math.floor(mouse.y / TILE_SIZE);
            let key = `${c},${r}`;

            // Range Check
            let playerCol = Math.floor((player.x + player.size/2) / TILE_SIZE);
            let playerRow = Math.floor((player.y + player.size/2) / TILE_SIZE);
            let dist = Math.abs(c - playerCol) + Math.abs(r - playerRow);
            if (dist >= 3) return; // Too far

            // 1. HOE: Grass -> Dirt
            if (currentTool === 1) {
                if (map[r][c] === 0) {
                    map[r][c] = 1;
                }
            }
            // 2. WATER: Dirt -> Wet Dirt
            else if (currentTool === 2) {
                if (map[r][c] === 1) {
                    map[r][c] = 2;
                }
            }
            // 3. SEEDS: Dirt/Wet -> Plant
            else if (currentTool === 3) {
                if ((map[r][c] === 1 || map[r][c] === 2) && !crops[key]) {
                    crops[key] = { stage: 1 };
                }
            }
            // 4. HARVEST: Mature -> Money
            else if (currentTool === 4) {
                if (crops[key] && crops[key].stage === 3) {
                    delete crops[key];
                    map[r][c] = 1; // Revert to dry dirt
                    money += 10;
                    document.getElementById('money-display').innerText = money;
                }
            }
        }

        function setTool(id) {
            currentTool = id;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById(`tool-${id}`).classList.add('active');
        }

        // --- EVENT LISTENERS ---

        window.addEventListener('keydown', e => {
            keys[e.key] = true;
            if(e.key === '1') setTool(1);
            if(e.key === '2') setTool(2);
            if(e.key === '3') setTool(3);
            if(e.key === '4') setTool(4);
        });

        window.addEventListener('keyup', e => keys[e.key] = false);

        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        });

        canvas.addEventListener('mousedown', handleAction);

        // Start
        init();

    </script>
</body>
</html>
